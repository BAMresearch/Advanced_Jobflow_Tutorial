

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>The Tutorial &#8212; Advanced Tutorial for Automating Tasks in Computational Materials Science with Jobflow</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" href="_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script src="_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'tutorial';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="Introduction" href="intro.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="intro.html">
  
  
  
  
  
    <p class="title logo__title">Advanced Tutorial for Automating Tasks in Computational Materials Science with Jobflow</p>
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="intro.html">
                    Introduction
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1 current active"><a class="current reference internal" href="#">The Tutorial</a></li>

</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://mybinder.org/v2/gh/executablebooks/jupyter-book/master?urlpath=tree/tutorial.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch onBinder"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img src="_static/images/logo_binder.svg">
  </span>
<span class="btn__text-container">Binder</span>
</a>
</li>
      
      
      
      
      <li><a href="https://colab.research.google.com/github/executablebooks/jupyter-book/blob/master/tutorial.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch onColab"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img src="_static/images/logo_colab.png">
  </span>
<span class="btn__text-container">Colab</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/tutorial.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>The Tutorial</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">The Tutorial</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#jobflow">Jobflow</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#install-software">Install Software</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#workflow-to-compute-the-equation-of-state-e-g-to-compute-a-bulk-modulus">Workflow to compute the equation of state (e.g., to compute a bulk modulus)</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#effective-medium-theory">Effective Medium Theory</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#structure-optimization">Structure optimization</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise">Exercise</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#phonon-workflow">Phonon workflow</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Exercise</a></li>
</ul>
</li>
</ul>

            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="the-tutorial">
<h1>The Tutorial<a class="headerlink" href="#the-tutorial" title="Permalink to this heading">#</a></h1>
<section id="jobflow">
<h2>Jobflow<a class="headerlink" href="#jobflow" title="Permalink to this heading">#</a></h2>
<p>We will use <a class="reference external" href="https://github.com/materialsproject/jobflow">jobflow</a> to write and execute workflows on our local machines. One can also start these computations on supercomputers.</p>
</section>
<section id="install-software">
<h2>Install Software<a class="headerlink" href="#install-software" title="Permalink to this heading">#</a></h2>
<p>We start by installing all relevant software. We will use jobflow but also two typical software from computational materials science. <a class="reference external" href="https://gitlab.com/ase/ase">ASE</a> and <a class="reference external" href="https://pymatgen.org/">pymatgen</a>. pymatgen works especially well together with jobflow as both have been developed by the <a class="reference external" href="https://materialsproject.org/">Materials Project</a>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>%%capture
!pip install jobflow
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>%%capture
!pip install ase
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>%%capture
!pip install pymatgen
</pre></div>
</div>
</div>
</div>
</section>
<section id="workflow-to-compute-the-equation-of-state-e-g-to-compute-a-bulk-modulus">
<h2>Workflow to compute the equation of state (e.g., to compute a bulk modulus)<a class="headerlink" href="#workflow-to-compute-the-equation-of-state-e-g-to-compute-a-bulk-modulus" title="Permalink to this heading">#</a></h2>
<p>In this first tutorial, we will build flows and jobs to automatize the computation of the equation of state. This tutorial has been inspired by the equation of state tutorial from ASE: <a class="reference external" href="https://wiki.fysik.dtu.dk/ase/tutorials/eos/eos.html">https://wiki.fysik.dtu.dk/ase/tutorials/eos/eos.html</a> . Please also check out this nice paper on equations of state: <a class="reference external" href="https://doi.org/10.1038/s41524-018-0091-x">K. Latimer, S. Dwaraknath, K. Mathew, D. Winston, K. A. Persson, npj Comput Mater 2018, 4, 40.</a> You can use each flavor with the help of pymatgen.</p>
<p>Let’s have a look how we would compute the results without workflow. This is only possible if we have a very fast calculator (i.e., some object to get energies and forces from ab initio theories or force fields) and small unit cells.</p>
<p>We will start by constructing a simple unit cell with the <code class="docutils literal notranslate"><span class="pre">Atoms</span></code> object in ASE: Ag in fcc structure type. The <code class="docutils literal notranslate"><span class="pre">Atoms</span></code> object in ASE is used to represent the structure. It can also be directly connected to electronic energies and forces when a calculator is added.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ase.build</span> <span class="kn">import</span> <span class="n">bulk</span>

<span class="n">atoms</span> <span class="o">=</span> <span class="n">bulk</span><span class="p">(</span><span class="s2">&quot;Ag&quot;</span><span class="p">,</span> <span class="s2">&quot;fcc&quot;</span><span class="p">,</span> <span class="mf">3.9</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">atoms</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Atoms(symbols=&#39;Ag&#39;, pbc=True, cell=[[0.0, 1.95, 1.95], [1.95, 0.0, 1.95], [1.95, 1.95, 0.0]])
</pre></div>
</div>
</div>
</div>
<p>You can visualize the structure unit cell when you uncomment the next lines.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#from ase.visualize import view</span>
<span class="c1">#view(atoms)</span>
</pre></div>
</div>
</div>
</div>
<p>Instead of using an ASE <code class="docutils literal notranslate"><span class="pre">Atoms</span></code> object, we will later on also use <code class="docutils literal notranslate"><span class="pre">Structure</span></code> objects from pymatgen. They are very handy as they can be easily transformed to dict representations in databases. There are conversion tools available in pymatgen. Let’s create a <code class="docutils literal notranslate"><span class="pre">Structure</span></code> object from an <code class="docutils literal notranslate"><span class="pre">Atoms</span></code> object. This is now just the structural information.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pymatgen.io.ase</span> <span class="kn">import</span> <span class="n">AseAtomsAdaptor</span>

<span class="n">structure</span> <span class="o">=</span> <span class="n">AseAtomsAdaptor</span><span class="p">()</span><span class="o">.</span><span class="n">get_structure</span><span class="p">(</span><span class="n">atoms</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">structure</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">structure</span><span class="o">.</span><span class="n">as_dict</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Full Formula (Ag1)
Reduced Formula: Ag
abc   :   2.757716   2.757716   2.757716
angles:  60.000000  60.000000  60.000000
pbc   :       True       True       True
Sites (1)
  #  SP      a    b    c
---  ----  ---  ---  ---
  0  Ag      0    0    0
{&#39;@module&#39;: &#39;pymatgen.core.structure&#39;, &#39;@class&#39;: &#39;Structure&#39;, &#39;charge&#39;: 0, &#39;lattice&#39;: {&#39;matrix&#39;: [[0.0, 1.95, 1.95], [1.95, 0.0, 1.95], [1.95, 1.95, 0.0]], &#39;pbc&#39;: (True, True, True), &#39;a&#39;: 2.7577164466275352, &#39;b&#39;: 2.7577164466275352, &#39;c&#39;: 2.7577164466275352, &#39;alpha&#39;: 59.99999999999999, &#39;beta&#39;: 59.99999999999999, &#39;gamma&#39;: 59.99999999999999, &#39;volume&#39;: 14.829749999999999}, &#39;sites&#39;: [{&#39;species&#39;: [{&#39;element&#39;: &#39;Ag&#39;, &#39;occu&#39;: 1}], &#39;abc&#39;: [0.0, 0.0, 0.0], &#39;xyz&#39;: [0.0, 0.0, 0.0], &#39;label&#39;: &#39;Ag&#39;, &#39;properties&#39;: {}}]}
</pre></div>
</div>
</div>
</div>
<section id="effective-medium-theory">
<h3>Effective Medium Theory<a class="headerlink" href="#effective-medium-theory" title="Permalink to this heading">#</a></h3>
<p>To calculate energies and forces, we will use effective-medium theory as described in <a class="reference external" href="https://journals.aps.org/prb/abstract/10.1103/PhysRevB.35.7423">K. W. Jacobsen, J. K. Norskov, M. J. Puska, Phys. Rev. B 1987, 35, 7423–7442.
</a>. This is mainly to be able to perform the computations without high-performance computers and still have somewhat reasonable results for simple solids such as Ag.  The method is based on an ansatz that assumes that the total electron density can be expressed as a sum of the electron densities of individual atoms. The electron densities of the individual atoms are calculated separately assuming that each atom is embedded in a homogeneous electron gas. It’s not necessary to understand this approximation in detail to perform the exercises. We really just need a simple calculator to get energies and forces… Note that normally our typical workflows use DFT.</p>
<p>Let’s add a calculator to the <code class="docutils literal notranslate"><span class="pre">Atoms</span></code> object.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ase.calculators.emt</span> <span class="kn">import</span> <span class="n">EMT</span>

<span class="n">atoms</span><span class="o">.</span><span class="n">calc</span> <span class="o">=</span> <span class="n">EMT</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="structure-optimization">
<h3>Structure optimization<a class="headerlink" href="#structure-optimization" title="Permalink to this heading">#</a></h3>
<p>We will use a standard optimizer from ASE (BFGS) here to perform the optimization. We add an additional Filter to also optimize the cell parameters and not only the atomic positions.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ase.optimize</span> <span class="kn">import</span> <span class="n">BFGS</span>
<span class="kn">from</span> <span class="nn">ase.constraints</span> <span class="kn">import</span> <span class="n">ExpCellFilter</span>

<span class="nb">print</span><span class="p">(</span><span class="n">atoms</span><span class="p">)</span>
<span class="n">opt</span> <span class="o">=</span> <span class="n">BFGS</span><span class="p">(</span><span class="n">ExpCellFilter</span><span class="p">(</span><span class="n">atoms</span><span class="p">))</span>
<span class="n">opt</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">fmax</span><span class="o">=</span><span class="mf">0.00001</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">atoms</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Atoms(symbols=&#39;Ag&#39;, pbc=True, cell=[[0.0, 1.95, 1.95], [1.95, 0.0, 1.95], [1.95, 1.95, 0.0]], calculator=EMT(...))
      Step     Time          Energy         fmax
BFGS:    0 11:58:24        0.088477        1.5173
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>BFGS:    1 11:58:24        0.018361        0.6601
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>BFGS:    2 11:58:24       -0.000016        0.0864
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>BFGS:    3 11:58:25       -0.000365        0.0064
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>BFGS:    4 11:58:25       -0.000367        0.0001
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>BFGS:    5 11:58:25       -0.000367        0.0000
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Atoms(symbols=&#39;Ag&#39;, pbc=True, cell=[[-2.298712018099952e-16, 2.0317762972959157, 2.0317762972959117], [2.0317762972959135, 2.3373590085817006e-15, 2.0317762972959117], [2.031776297295913, 2.0317762972959126, 1.2589072243282675e-16]], calculator=EMT(...))
</pre></div>
</div>
</div>
</div>
<p>As you can see the cell parameters have slightly changed. The atomic positions will not really change due to the high symmetry.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">atoms</span><span class="o">.</span><span class="n">calc</span><span class="o">.</span><span class="n">results</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;energy&#39;: -0.00036686253946172087, &#39;energies&#39;: array([-0.00036686]), &#39;free_energy&#39;: -0.00036686253946172087, &#39;forces&#39;: array([[0., 0., 0.]]), &#39;stress&#39;: array([-3.44910465e-09, -3.44910586e-09, -3.44910471e-09,  5.07608054e-16,
        1.58738221e-17, -7.53100562e-17])}
</pre></div>
</div>
</div>
</div>
<p>After this optimization of the structure, we will now scale the cell parameters to get our energy volume curve, i.e. we evaluate the energy at different volumes. Starting with the current cell parameters:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cell</span> <span class="o">=</span> <span class="n">atoms</span><span class="o">.</span><span class="n">get_cell</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">cell</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Cell([[-2.298712018099952e-16, 2.0317762972959157, 2.0317762972959117], [2.0317762972959135, 2.3373590085817006e-15, 2.0317762972959117], [2.031776297295913, 2.0317762972959126, 1.2589072243282675e-16]])
</pre></div>
</div>
</div>
</div>
<p>Let’s try the scaling:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">new_cell</span> <span class="o">=</span> <span class="n">cell</span> <span class="o">*</span> <span class="mf">1.01</span>
<span class="nb">print</span><span class="p">(</span><span class="n">new_cell</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">cell</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[[-2.32169914e-16  2.05209406e+00  2.05209406e+00]
 [ 2.05209406e+00  2.36073260e-15  2.05209406e+00]
 [ 2.05209406e+00  2.05209406e+00  1.27149630e-16]]
Cell([[-2.298712018099952e-16, 2.0317762972959157, 2.0317762972959117], [2.0317762972959135, 2.3373590085817006e-15, 2.0317762972959117], [2.031776297295913, 2.0317762972959126, 1.2589072243282675e-16]])
</pre></div>
</div>
</div>
</div>
<p>Now, let’s perform the energy volume curve computation. The optimizations that we will perform will now be at constant volume. We are collecting the volumes and energies.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">ase.io.trajectory</span> <span class="kn">import</span> <span class="n">Trajectory</span>
<span class="kn">from</span> <span class="nn">copy</span> <span class="kn">import</span> <span class="n">deepcopy</span>

<span class="n">cell</span> <span class="o">=</span> <span class="n">atoms</span><span class="o">.</span><span class="n">get_cell</span><span class="p">()</span>

<span class="n">volumes</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">energies</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">[</span><span class="mf">0.95</span><span class="p">,</span> <span class="mf">0.97</span><span class="p">,</span> <span class="mf">0.99</span><span class="p">,</span> <span class="mf">1.00</span><span class="p">,</span> <span class="mf">1.01</span><span class="p">,</span> <span class="mf">1.03</span><span class="p">,</span> <span class="mf">1.05</span><span class="p">]:</span>
    <span class="n">optimized_atoms</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">atoms</span><span class="p">)</span>
    <span class="n">optimized_atoms</span><span class="o">.</span><span class="n">set_cell</span><span class="p">(</span><span class="n">cell</span> <span class="o">*</span> <span class="n">x</span><span class="p">,</span> <span class="n">scale_atoms</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">opt</span> <span class="o">=</span> <span class="n">BFGS</span><span class="p">(</span><span class="n">ExpCellFilter</span><span class="p">(</span><span class="n">optimized_atoms</span><span class="p">,</span> <span class="n">constant_volume</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
    <span class="n">opt</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">fmax</span><span class="o">=</span><span class="mf">0.00001</span><span class="p">)</span>
    <span class="n">volumes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">optimized_atoms</span><span class="o">.</span><span class="n">get_volume</span><span class="p">())</span>
    <span class="n">energies</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">optimized_atoms</span><span class="o">.</span><span class="n">get_potential_energy</span><span class="p">())</span>

<span class="nb">print</span><span class="p">(</span><span class="n">volumes</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">energies</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>      Step     Time          Energy         fmax
BFGS:    0 11:58:25        0.141689        0.0000
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>      Step     Time          Energy         fmax
BFGS:    0 11:58:25        0.047146        0.0000
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>      Step     Time          Energy         fmax
BFGS:    0 11:58:25        0.004531        0.0000
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>      Step     Time          Energy         fmax
BFGS:    0 11:58:25       -0.000367        0.0000
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>      Step     Time          Energy         fmax
BFGS:    0 11:58:25        0.004180        0.0000
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>      Step     Time          Energy         fmax
BFGS:    0 11:58:25        0.037658        0.0000
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>      Step     Time          Energy         fmax
BFGS:    0 11:58:25        0.098005        0.0000
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[14.382304526892272, 15.309918086569299, 16.27658340882234, 16.774812103096398, 17.283105684632318, 18.330290104980214, 19.418941860846967]
[0.14168852968516887, 0.04714559046761835, 0.004531478880869244, -0.00036686253946172087, 0.004180145974302718, 0.03765776040276947, 0.0980053988235543]
</pre></div>
</div>
</div>
</div>
<p>Let’s do a plot of the equation of states now.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ase.units</span> <span class="kn">import</span> <span class="n">kJ</span>
<span class="kn">from</span> <span class="nn">ase.eos</span> <span class="kn">import</span> <span class="n">EquationOfState</span>

<span class="n">eos</span> <span class="o">=</span> <span class="n">EquationOfState</span><span class="p">(</span><span class="n">volumes</span><span class="p">,</span> <span class="n">energies</span><span class="p">)</span>
<span class="n">v0</span><span class="p">,</span> <span class="n">e0</span><span class="p">,</span> <span class="n">B</span> <span class="o">=</span> <span class="n">eos</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">B</span><span class="p">,</span> <span class="s1">&#39;eV Angstrom**(-3)&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">B</span> <span class="o">/</span> <span class="n">kJ</span> <span class="o">*</span> <span class="mf">1.0e24</span><span class="p">,</span> <span class="s1">&#39;GPa&#39;</span><span class="p">)</span>
<span class="n">eos</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="s1">&#39;Ag-eos.png&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.6242845498684262 eV Angstrom**(-3)
100.02141105258441 GPa
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Axes: title={&#39;center&#39;: &#39;sj: E: -0.000 eV, V: 16.776 Å$^3$, B: 100.021 GPa&#39;}, xlabel=&#39;volume [Å$^3$]&#39;, ylabel=&#39;energy [eV]&#39;&gt;
</pre></div>
</div>
<img alt="_images/5b3a77a766329a70c0d5777fd61a79526a4a3552d91de475ec293d3161d3685c.png" src="_images/5b3a77a766329a70c0d5777fd61a79526a4a3552d91de475ec293d3161d3685c.png" />
</div>
</div>
<p>This is fine. You can check out the DFT equations of state here: <a class="reference external" href="https://materialsproject.org/materials/mp-124?chemsys=Ag#equations_of_state">https://materialsproject.org/materials/mp-124?chemsys=Ag#equations_of_state</a> The volume is different by 1 Angstrom³ and Bulk modulus is off by a factor of 10 depending on the equation of state.</p>
<p>We now have a workflow that looks roughly like this:</p>
<p><img alt="Workflow" src="workflow.png" /></p>
<p>Let’s work on an atomic job to optimize the structure. We will use a <code class="docutils literal notranslate"><span class="pre">Structure</span></code> object to carry the structural information as it can be easily transformed into a dict. We need this as we will save our results in databases that build upon the json and yaml format. This is more complicated for an <code class="docutils literal notranslate"><span class="pre">Atoms</span></code> object. Check out <span class="xref myst">https://materialsproject.github.io/maggma/concepts</span> to learn more.</p>
<p>To write an atomic job in jobflow, we have to inherit from the Maker class and adapt the make method. Please don’t forget the decorators as they are central for the execution of the workflow. You can find more about jobs here: <a class="reference external" href="https://materialsproject.github.io/jobflow/tutorials/3-defining-jobs.html">https://materialsproject.github.io/jobflow/tutorials/3-defining-jobs.html</a>
Such a Maker class will also get the decorator &#64;dataclass . This will add special methods to the class. See here for more info: <a class="reference external" href="https://docs.python.org/3/library/dataclasses.html">https://docs.python.org/3/library/dataclasses.html</a></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">jobflow.core.maker</span> <span class="kn">import</span> <span class="n">Maker</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/home/jgeorge/miniconda3/envs/AutomationTutorial/lib/python3.10/site-packages/maggma/utils.py:21: TqdmWarning: IProgress not found. Please update jupyter and ipywidgets. See https://ipywidgets.readthedocs.io/en/stable/user_install.html
  from tqdm.autonotebook import tqdm
</pre></div>
</div>
</div>
</div>
<p>We add a <code class="docutils literal notranslate"><span class="pre">name</span></code> to the maker which will later on help us identify which job is running.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">dataclasses</span> <span class="kn">import</span> <span class="n">dataclass</span>
<span class="kn">from</span> <span class="nn">jobflow</span> <span class="kn">import</span> <span class="n">job</span><span class="p">,</span> <span class="n">Maker</span>
<span class="kn">from</span> <span class="nn">pymatgen.core.structure</span> <span class="kn">import</span> <span class="n">Structure</span>


<span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">OptimizeJob</span><span class="p">(</span><span class="n">Maker</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Class to carry out a full optimization of a structure with the EMT calculator</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    name</span>
<span class="sd">        Name of the job.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;EMT-Optimization&quot;</span>

    <span class="nd">@job</span>
    <span class="k">def</span> <span class="nf">make</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">structure</span><span class="p">:</span> <span class="n">Structure</span><span class="p">):</span>
        <span class="k">pass</span>
</pre></div>
</div>
</div>
</div>
<p>The make method will take structure as an input. In the next step, we simply add steps to perform the optimization. Thus, we take the same classes, methods and functions as before:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">dataclasses</span> <span class="kn">import</span> <span class="n">dataclass</span>
<span class="kn">from</span> <span class="nn">jobflow</span> <span class="kn">import</span> <span class="n">job</span>
<span class="kn">from</span> <span class="nn">pymatgen.core.structure</span> <span class="kn">import</span> <span class="n">Structure</span>


<span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">OptimizeJob</span><span class="p">(</span><span class="n">Maker</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Class to carry out a full optimization of a structure with the EMT calculator</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    name</span>
<span class="sd">        Name of the job.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;EMT-Optimization&quot;</span>

    <span class="nd">@job</span>
    <span class="k">def</span> <span class="nf">make</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">structure</span><span class="p">:</span> <span class="n">Structure</span><span class="p">):</span>
        <span class="n">adaptor</span> <span class="o">=</span> <span class="n">AseAtomsAdaptor</span><span class="p">()</span>
        <span class="n">atoms</span> <span class="o">=</span> <span class="n">adaptor</span><span class="o">.</span><span class="n">get_atoms</span><span class="p">(</span><span class="n">structure</span><span class="p">)</span>  <span class="c1"># get an atoms object</span>
        <span class="n">atoms</span><span class="o">.</span><span class="n">calc</span> <span class="o">=</span> <span class="n">EMT</span><span class="p">()</span>  <span class="c1"># add emt as a calculator</span>

        <span class="n">opt</span> <span class="o">=</span> <span class="n">BFGS</span><span class="p">(</span><span class="n">ExpCellFilter</span><span class="p">(</span><span class="n">atoms</span><span class="p">))</span>  <span class="c1"># optimize the structure including cell parameters</span>
        <span class="n">opt</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">fmax</span><span class="o">=</span><span class="mf">0.00001</span><span class="p">)</span>  <span class="c1"># run the optimization</span>
</pre></div>
</div>
</div>
</div>
<p>We have now optimized our structure. We might want to add <code class="docutils literal notranslate"><span class="pre">fmax</span></code> as a parameter of our Maker to change the default values. We will not do this for all potential settings as it just takes a lot of time to implement and we just want to find out how it works and not do a lot of work…</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">OptimizeJob</span><span class="p">(</span><span class="n">Maker</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Class to carry out a full optimization of a structure with the EMT calculator</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    name</span>
<span class="sd">        Name of the job.</span>
<span class="sd">    fmax</span>
<span class="sd">        float that determines the forces after optimization</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;EMT-Optimization&quot;</span>
    <span class="n">fmax</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.00001</span>

    <span class="nd">@job</span>
    <span class="k">def</span> <span class="nf">make</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">structure</span><span class="p">:</span> <span class="n">Structure</span><span class="p">):</span>
        <span class="n">adaptor</span> <span class="o">=</span> <span class="n">AseAtomsAdaptor</span><span class="p">()</span>
        <span class="n">atoms</span> <span class="o">=</span> <span class="n">adaptor</span><span class="o">.</span><span class="n">get_atoms</span><span class="p">(</span><span class="n">structure</span><span class="p">)</span>
        <span class="n">atoms</span><span class="o">.</span><span class="n">calc</span> <span class="o">=</span> <span class="n">EMT</span><span class="p">()</span>
        <span class="n">opt</span> <span class="o">=</span> <span class="n">BFGS</span><span class="p">(</span><span class="n">ExpCellFilter</span><span class="p">(</span><span class="n">atoms</span><span class="p">))</span>
        <span class="n">opt</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">fmax</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fmax</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>We will add another parameter <code class="docutils literal notranslate"><span class="pre">constant_volume</span></code> to be able to do a constant volume optimization with the same maker.</p>
<p>To be able to connect different interdependent jobs, we also need to save our results (method should return the results we want to use further down the line) so that we can transfer our results between jobs. We will do this in next step. For now, it will be enough to save the optimized structure and the energy at the end. You can also save forces, stresses and so on… People typically develop very large schema. This is again just a lot of work and will not help us to understand the automation itself. It’s again just important that all outputs are either a dict or have the as_dict() method.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">OptimizeJob</span><span class="p">(</span><span class="n">Maker</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Class to carry out a full optimization of an atoms object</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    name</span>
<span class="sd">        Name of the job.</span>
<span class="sd">    fmax</span>
<span class="sd">        float that determines the forces after optimization</span>
<span class="sd">    constant_volume</span>
<span class="sd">        bool that if true will enforce an optimization with constant volume</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;EMT-Optimization&quot;</span>
    <span class="n">fmax</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.00001</span>
    <span class="n">constant_volume</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="nd">@job</span>
    <span class="k">def</span> <span class="nf">make</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">structure</span><span class="p">:</span> <span class="n">Structure</span><span class="p">):</span>
        <span class="n">adaptor</span> <span class="o">=</span> <span class="n">AseAtomsAdaptor</span><span class="p">()</span>
        <span class="n">atoms</span> <span class="o">=</span> <span class="n">adaptor</span><span class="o">.</span><span class="n">get_atoms</span><span class="p">(</span><span class="n">structure</span><span class="p">)</span>
        <span class="n">atoms</span><span class="o">.</span><span class="n">calc</span> <span class="o">=</span> <span class="n">EMT</span><span class="p">()</span>
        <span class="n">opt</span> <span class="o">=</span> <span class="n">BFGS</span><span class="p">(</span><span class="n">ExpCellFilter</span><span class="p">(</span><span class="n">atoms</span><span class="p">,</span> <span class="n">constant_volume</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">constant_volume</span><span class="p">))</span>
        <span class="n">opt</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">fmax</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fmax</span><span class="p">)</span>

        <span class="n">out_structure</span> <span class="o">=</span> <span class="n">adaptor</span><span class="o">.</span><span class="n">get_structure</span><span class="p">(</span><span class="n">atoms</span><span class="p">)</span>

        <span class="n">results</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">results</span><span class="p">[</span><span class="s2">&quot;optimized_structure&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">out_structure</span>
        <span class="n">results</span><span class="p">[</span><span class="s2">&quot;input_structure&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">structure</span>
        <span class="n">results</span><span class="p">[</span><span class="s2">&quot;energy&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">atoms</span><span class="o">.</span><span class="n">get_potential_energy</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">results</span>
</pre></div>
</div>
</div>
</div>
<p>For test purposes, we will simply now chain two optimizations, put them in a Flow (i.e., the object for workflows) and see what happens. We also always have to define an output for the flow. Very often, this is the output of the last job in the flow.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">jobflow.managers.local</span> <span class="kn">import</span> <span class="n">run_locally</span>
<span class="kn">from</span> <span class="nn">jobflow</span> <span class="kn">import</span> <span class="n">Flow</span>

<span class="n">atoms</span> <span class="o">=</span> <span class="n">bulk</span><span class="p">(</span><span class="s2">&quot;Ag&quot;</span><span class="p">,</span> <span class="s2">&quot;fcc&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<span class="n">structure</span> <span class="o">=</span> <span class="n">AseAtomsAdaptor</span><span class="p">()</span><span class="o">.</span><span class="n">get_structure</span><span class="p">(</span><span class="n">atoms</span><span class="p">)</span>
<span class="n">maker_fullopt</span> <span class="o">=</span> <span class="n">OptimizeJob</span><span class="p">()</span>
<span class="n">maker_opt_constant_vol</span> <span class="o">=</span> <span class="n">OptimizeJob</span><span class="p">(</span><span class="n">constant_volume</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">job1</span> <span class="o">=</span> <span class="n">maker_fullopt</span><span class="o">.</span><span class="n">make</span><span class="p">(</span><span class="n">structure</span><span class="o">=</span><span class="n">structure</span><span class="p">)</span>
<span class="n">job2</span> <span class="o">=</span> <span class="n">maker_opt_constant_vol</span><span class="o">.</span><span class="n">make</span><span class="p">(</span><span class="n">structure</span><span class="o">=</span><span class="n">job1</span><span class="o">.</span><span class="n">output</span><span class="p">[</span><span class="s2">&quot;optimized_structure&quot;</span><span class="p">])</span>

<span class="n">flow</span> <span class="o">=</span> <span class="n">Flow</span><span class="p">([</span><span class="n">job1</span><span class="p">,</span> <span class="n">job2</span><span class="p">],</span> <span class="n">output</span><span class="o">=</span><span class="n">job2</span><span class="o">.</span><span class="n">output</span><span class="p">)</span>

<span class="n">response</span> <span class="o">=</span> <span class="n">run_locally</span><span class="p">(</span><span class="n">flow</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2023-06-02 11:58:26,551 INFO Started executing jobs locally
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2023-06-02 11:58:26,629 INFO Starting job - EMT-Optimization (1e49d85d-7f4d-4444-a29c-36ba23afe599)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>      Step     Time          Energy         fmax
BFGS:    0 11:58:26        0.011870        0.5285
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>BFGS:    1 11:58:26        0.002888        0.2672
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>BFGS:    2 11:58:26       -0.000355        0.0156
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>BFGS:    3 11:58:26       -0.000367        0.0005
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>BFGS:    4 11:58:26       -0.000367        0.0000
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2023-06-02 11:58:26,768 INFO Finished job - EMT-Optimization (1e49d85d-7f4d-4444-a29c-36ba23afe599)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2023-06-02 11:58:26,769 INFO Starting job - EMT-Optimization (d160ca5e-eb76-4328-b593-dd430100ff7a)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>      Step     Time          Energy         fmax
BFGS:    0 11:58:26       -0.000367        0.0000
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2023-06-02 11:58:26,808 INFO Finished job - EMT-Optimization (d160ca5e-eb76-4328-b593-dd430100ff7a)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2023-06-02 11:58:26,809 INFO Finished executing jobs locally
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;1e49d85d-7f4d-4444-a29c-36ba23afe599&#39;: {1: Response(output={&#39;optimized_structure&#39;: Structure Summary
Lattice
    abc : 2.87336550651202 2.8733655065120205 2.87336550651202
 angles : 59.99999999999999 60.00000000000001 59.99999999999999
 volume : 16.774810547282314
      A : -1.0240902968258463e-16 2.031776234482168 2.0317762344821686
      B : 2.0317762344821686 2.323574183069503e-17 2.0317762344821686
      C : 2.0317762344821686 2.031776234482168 -2.8552862920234554e-17
    pbc : True True True
PeriodicSite: Ag (0.0000, 0.0000, 0.0000) [0.0000, 0.0000, 0.0000], &#39;input_structure&#39;: Structure Summary
Lattice
    abc : 2.8284271247461903 2.8284271247461903 2.8284271247461903
 angles : 60.00000000000001 60.00000000000001 60.00000000000001
 volume : 16.0
      A : 0.0 2.0 2.0
      B : 2.0 0.0 2.0
      C : 2.0 2.0 0.0
    pbc : True True True
PeriodicSite: Ag (0.0000, 0.0000, 0.0000) [0.0000, 0.0000, 0.0000], &#39;energy&#39;: -0.000366862539422641}, detour=None, addition=None, replace=None, stored_data=None, stop_children=False, stop_jobflow=False)}, &#39;d160ca5e-eb76-4328-b593-dd430100ff7a&#39;: {1: Response(output={&#39;optimized_structure&#39;: Structure Summary
Lattice
    abc : 2.87336550651202 2.8733655065120205 2.87336550651202
 angles : 59.99999999999999 60.00000000000001 59.99999999999999
 volume : 16.774810547282314
      A : -1.0240902968258463e-16 2.031776234482168 2.0317762344821686
      B : 2.0317762344821686 2.323574183069503e-17 2.0317762344821686
      C : 2.0317762344821686 2.031776234482168 -2.8552862920234554e-17
    pbc : True True True
PeriodicSite: Ag (0.0000, 0.0000, 0.0000) [0.0000, 0.0000, 0.0000], &#39;input_structure&#39;: Structure Summary
Lattice
    abc : 2.87336550651202 2.8733655065120205 2.87336550651202
 angles : 59.99999999999999 60.00000000000001 59.99999999999999
 volume : 16.774810547282314
      A : -1.0240902968258463e-16 2.031776234482168 2.0317762344821686
      B : 2.0317762344821686 2.323574183069503e-17 2.0317762344821686
      C : 2.0317762344821686 2.031776234482168 -2.8552862920234554e-17
    pbc : True True True
PeriodicSite: Ag (0.0000, 0.0000, 0.0000) [0.0000, 0.0000, 0.0000], &#39;energy&#39;: -0.000366862539422641}, detour=None, addition=None, replace=None, stored_data=None, stop_children=False, stop_jobflow=False)}}
</pre></div>
</div>
</div>
</div>
<p>This is nice but of course a bit useless. Btw, you can also create folders for each atomic job in your workflow by using one of the parameters in run_locally.</p>
<p>We now need to build a job that creates structures with different volumes, runs the optimizations with constant volume, and one job that can assess the results!</p>
<p>We will start by using a job that is called <code class="docutils literal notranslate"><span class="pre">get_ev_curve</span></code>. It will replace itself with a Response object that will start a completely new workflow. As outputs, we will collect all optimized structures and the corresponding energies!</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">jobflow</span> <span class="kn">import</span> <span class="n">Response</span><span class="p">,</span> <span class="n">job</span>


<span class="nd">@job</span>
<span class="k">def</span> <span class="nf">get_ev_curve</span><span class="p">(</span><span class="n">structure</span><span class="p">:</span> <span class="n">Structure</span><span class="p">,</span> <span class="n">volumes</span><span class="o">=</span><span class="p">[</span><span class="mf">0.95</span><span class="p">,</span> <span class="mf">0.97</span><span class="p">,</span> <span class="mf">0.99</span><span class="p">,</span> <span class="mf">1.00</span><span class="p">,</span> <span class="mf">1.01</span><span class="p">,</span> <span class="mf">1.03</span><span class="p">,</span> <span class="mf">1.05</span><span class="p">]):</span>
    <span class="n">groundstate_vol</span> <span class="o">=</span> <span class="n">structure</span><span class="o">.</span><span class="n">volume</span>
    <span class="n">const_vol_maker</span> <span class="o">=</span> <span class="n">OptimizeJob</span><span class="p">(</span><span class="n">constant_volume</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">job_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">outputs</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;optimized_structures&quot;</span><span class="p">:</span> <span class="p">[],</span>
        <span class="s2">&quot;energies&quot;</span><span class="p">:</span> <span class="p">[],</span>
    <span class="p">}</span>
    <span class="k">for</span> <span class="n">vol_inc</span> <span class="ow">in</span> <span class="n">volumes</span><span class="p">:</span>
        <span class="n">struct_here</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">structure</span><span class="p">)</span>
        <span class="n">struct_here</span><span class="o">.</span><span class="n">scale_lattice</span><span class="p">(</span><span class="n">groundstate_vol</span> <span class="o">*</span> <span class="n">vol_inc</span><span class="p">)</span>
        <span class="n">relax_job</span> <span class="o">=</span> <span class="n">const_vol_maker</span><span class="o">.</span><span class="n">make</span><span class="p">(</span><span class="n">struct_here</span><span class="p">)</span>
        <span class="n">job_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">relax_job</span><span class="p">)</span>
        <span class="n">outputs</span><span class="p">[</span><span class="s2">&quot;optimized_structures&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">relax_job</span><span class="o">.</span><span class="n">output</span><span class="p">[</span><span class="s2">&quot;optimized_structure&quot;</span><span class="p">])</span>
        <span class="n">outputs</span><span class="p">[</span><span class="s2">&quot;energies&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">relax_job</span><span class="o">.</span><span class="n">output</span><span class="p">[</span><span class="s2">&quot;energy&quot;</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="n">replace</span><span class="o">=</span><span class="n">Flow</span><span class="p">(</span><span class="n">job_list</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="n">outputs</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p>We can now build a flow including a full optmization and this code to start the constant volume optimizations</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">atoms</span> <span class="o">=</span> <span class="n">bulk</span><span class="p">(</span><span class="s2">&quot;Ag&quot;</span><span class="p">,</span> <span class="s2">&quot;fcc&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<span class="n">structure</span> <span class="o">=</span> <span class="n">AseAtomsAdaptor</span><span class="p">()</span><span class="o">.</span><span class="n">get_structure</span><span class="p">(</span><span class="n">atoms</span><span class="p">)</span>
<span class="n">maker_fullopt</span> <span class="o">=</span> <span class="n">OptimizeJob</span><span class="p">()</span>
<span class="n">maker_opt_constant_vol</span> <span class="o">=</span> <span class="n">OptimizeJob</span><span class="p">(</span><span class="n">constant_volume</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">job1</span> <span class="o">=</span> <span class="n">maker_fullopt</span><span class="o">.</span><span class="n">make</span><span class="p">(</span><span class="n">structure</span><span class="o">=</span><span class="n">structure</span><span class="p">)</span>
<span class="n">job2</span> <span class="o">=</span> <span class="n">get_ev_curve</span><span class="p">(</span><span class="n">structure</span><span class="o">=</span><span class="n">job1</span><span class="o">.</span><span class="n">output</span><span class="p">[</span><span class="s2">&quot;optimized_structure&quot;</span><span class="p">])</span>

<span class="n">flow</span> <span class="o">=</span> <span class="n">Flow</span><span class="p">([</span><span class="n">job1</span><span class="p">,</span> <span class="n">job2</span><span class="p">],</span> <span class="n">output</span><span class="o">=</span><span class="n">job2</span><span class="o">.</span><span class="n">output</span><span class="p">)</span>

<span class="n">response</span> <span class="o">=</span> <span class="n">run_locally</span><span class="p">(</span><span class="n">flow</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2023-06-02 11:58:26,836 INFO Started executing jobs locally
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2023-06-02 11:58:26,839 INFO Starting job - EMT-Optimization (6d71880a-04d5-4369-82eb-84a9bbd54e93)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>      Step     Time          Energy         fmax
BFGS:    0 11:58:26        0.011870        0.5285
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>BFGS:    1 11:58:26        0.002888        0.2672
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>BFGS:    2 11:58:26       -0.000355        0.0156
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>BFGS:    3 11:58:26       -0.000367        0.0005
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>BFGS:    4 11:58:26       -0.000367        0.0000
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2023-06-02 11:58:26,972 INFO Finished job - EMT-Optimization (6d71880a-04d5-4369-82eb-84a9bbd54e93)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2023-06-02 11:58:26,973 INFO Starting job - get_ev_curve (bc5071bc-d614-44b9-af17-7efeeda6201a)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2023-06-02 11:58:26,993 INFO Finished job - get_ev_curve (bc5071bc-d614-44b9-af17-7efeeda6201a)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2023-06-02 11:58:26,999 INFO Starting job - EMT-Optimization (a57354bd-3676-4915-ac84-31c686c855da)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>      Step     Time          Energy         fmax
BFGS:    0 11:58:27        0.014081        0.0000
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2023-06-02 11:58:27,035 INFO Finished job - EMT-Optimization (a57354bd-3676-4915-ac84-31c686c855da)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2023-06-02 11:58:27,036 INFO Starting job - EMT-Optimization (399e34c3-684a-42bc-96a8-c5f555ed76c4)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>      Step     Time          Energy         fmax
BFGS:    0 11:58:27        0.004634        0.0000
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2023-06-02 11:58:27,071 INFO Finished job - EMT-Optimization (399e34c3-684a-42bc-96a8-c5f555ed76c4)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2023-06-02 11:58:27,075 INFO Starting job - EMT-Optimization (479ee260-910f-407c-a320-1ea53f0a3a64)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>      Step     Time          Energy         fmax
BFGS:    0 11:58:27        0.000168        0.0000
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2023-06-02 11:58:27,109 INFO Finished job - EMT-Optimization (479ee260-910f-407c-a320-1ea53f0a3a64)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2023-06-02 11:58:27,110 INFO Starting job - EMT-Optimization (55d604e2-10b0-414a-ba7f-184d3fa01c39)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>      Step     Time          Energy         fmax
BFGS:    0 11:58:27       -0.000367        0.0000
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2023-06-02 11:58:27,140 INFO Finished job - EMT-Optimization (55d604e2-10b0-414a-ba7f-184d3fa01c39)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2023-06-02 11:58:27,141 INFO Starting job - EMT-Optimization (e89b2dc3-dc94-4a14-a6bb-0153c5cbe1a2)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>      Step     Time          Energy         fmax
BFGS:    0 11:58:27        0.000148        0.0000
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2023-06-02 11:58:27,174 INFO Finished job - EMT-Optimization (e89b2dc3-dc94-4a14-a6bb-0153c5cbe1a2)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2023-06-02 11:58:27,175 INFO Starting job - EMT-Optimization (e6442db3-5917-4b9c-891e-f584f55dc3fe)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>      Step     Time          Energy         fmax
BFGS:    0 11:58:27        0.004093        0.0000
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2023-06-02 11:58:27,208 INFO Finished job - EMT-Optimization (e6442db3-5917-4b9c-891e-f584f55dc3fe)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2023-06-02 11:58:27,209 INFO Starting job - EMT-Optimization (cb86a961-c53f-4093-97cc-c30501a1d3d8)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>      Step     Time          Energy         fmax
BFGS:    0 11:58:27        0.011572        0.0000
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2023-06-02 11:58:27,241 INFO Finished job - EMT-Optimization (cb86a961-c53f-4093-97cc-c30501a1d3d8)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2023-06-02 11:58:27,243 INFO Starting job - store_inputs (bc5071bc-d614-44b9-af17-7efeeda6201a, 2)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2023-06-02 11:58:27,246 INFO Finished job - store_inputs (bc5071bc-d614-44b9-af17-7efeeda6201a, 2)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2023-06-02 11:58:27,247 INFO Finished executing jobs locally
</pre></div>
</div>
</div>
</div>
<p>We will now write a tiny job that will collect all results. It will start from a list of structures and energies and then plot an EV curve to a file and return the most important results.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nd">@job</span>
<span class="k">def</span> <span class="nf">get_results_ev_curve</span><span class="p">(</span><span class="n">list_structures</span><span class="p">,</span> <span class="n">list_energies</span><span class="p">):</span>
    <span class="n">list_volumes</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">struct</span> <span class="ow">in</span> <span class="n">list_structures</span><span class="p">:</span>
        <span class="n">list_volumes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">struct</span><span class="o">.</span><span class="n">volume</span><span class="p">)</span>

    <span class="n">eos</span> <span class="o">=</span> <span class="n">EquationOfState</span><span class="p">(</span><span class="n">list_volumes</span><span class="p">,</span> <span class="n">list_energies</span><span class="p">)</span>
    <span class="n">v0</span><span class="p">,</span> <span class="n">e0</span><span class="p">,</span> <span class="n">B</span> <span class="o">=</span> <span class="n">eos</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
    <span class="n">eos</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="s1">&#39;eos.png&#39;</span><span class="p">)</span>

    <span class="n">results</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">results</span><span class="p">[</span><span class="s2">&quot;V0&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">v0</span>
    <span class="n">results</span><span class="p">[</span><span class="s2">&quot;e0&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">e0</span>
    <span class="n">results</span><span class="p">[</span><span class="s2">&quot;B&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">B</span>

    <span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Now, we combine all jobs to a larger workflow and check out the output.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">atoms</span> <span class="o">=</span> <span class="n">bulk</span><span class="p">(</span><span class="s2">&quot;Ag&quot;</span><span class="p">,</span> <span class="s2">&quot;fcc&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<span class="n">structure</span> <span class="o">=</span> <span class="n">AseAtomsAdaptor</span><span class="p">()</span><span class="o">.</span><span class="n">get_structure</span><span class="p">(</span><span class="n">atoms</span><span class="p">)</span>
<span class="n">maker_fullopt</span> <span class="o">=</span> <span class="n">OptimizeJob</span><span class="p">()</span>
<span class="n">job1</span> <span class="o">=</span> <span class="n">maker_fullopt</span><span class="o">.</span><span class="n">make</span><span class="p">(</span><span class="n">structure</span><span class="o">=</span><span class="n">structure</span><span class="p">)</span>
<span class="n">job2</span> <span class="o">=</span> <span class="n">get_ev_curve</span><span class="p">(</span><span class="n">structure</span><span class="o">=</span><span class="n">job1</span><span class="o">.</span><span class="n">output</span><span class="p">[</span><span class="s2">&quot;optimized_structure&quot;</span><span class="p">])</span>
<span class="n">job3</span> <span class="o">=</span> <span class="n">get_results_ev_curve</span><span class="p">(</span><span class="n">list_structures</span><span class="o">=</span><span class="n">job2</span><span class="o">.</span><span class="n">output</span><span class="p">[</span><span class="s2">&quot;optimized_structures&quot;</span><span class="p">],</span> <span class="n">list_energies</span><span class="o">=</span><span class="n">job2</span><span class="o">.</span><span class="n">output</span><span class="p">[</span><span class="s2">&quot;energies&quot;</span><span class="p">])</span>
<span class="n">flow</span> <span class="o">=</span> <span class="n">Flow</span><span class="p">([</span><span class="n">job1</span><span class="p">,</span> <span class="n">job2</span><span class="p">,</span> <span class="n">job3</span><span class="p">],</span> <span class="n">output</span><span class="o">=</span><span class="n">job3</span><span class="o">.</span><span class="n">output</span><span class="p">)</span>

<span class="n">response</span> <span class="o">=</span> <span class="n">run_locally</span><span class="p">(</span><span class="n">flow</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">response</span><span class="p">[</span><span class="n">flow</span><span class="o">.</span><span class="n">jobs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">uuid</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">output</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2023-06-02 11:58:27,272 INFO Started executing jobs locally
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2023-06-02 11:58:27,274 INFO Starting job - EMT-Optimization (d800a7b4-5eab-4d3a-b63c-5a140adbd8b4)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>      Step     Time          Energy         fmax
BFGS:    0 11:58:27        0.011870        0.5285
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>BFGS:    1 11:58:27        0.002888        0.2672
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>BFGS:    2 11:58:27       -0.000355        0.0156
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>BFGS:    3 11:58:27       -0.000367        0.0005
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>BFGS:    4 11:58:27       -0.000367        0.0000
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2023-06-02 11:58:27,398 INFO Finished job - EMT-Optimization (d800a7b4-5eab-4d3a-b63c-5a140adbd8b4)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2023-06-02 11:58:27,400 INFO Starting job - get_ev_curve (cc5a0c98-baff-4c82-850c-cb9c66888266)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2023-06-02 11:58:27,418 INFO Finished job - get_ev_curve (cc5a0c98-baff-4c82-850c-cb9c66888266)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2023-06-02 11:58:27,424 INFO Starting job - EMT-Optimization (c23111ed-52fe-43b7-9313-396e919729bf)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>      Step     Time          Energy         fmax
BFGS:    0 11:58:27        0.014081        0.0000
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2023-06-02 11:58:27,458 INFO Finished job - EMT-Optimization (c23111ed-52fe-43b7-9313-396e919729bf)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2023-06-02 11:58:27,460 INFO Starting job - EMT-Optimization (2f280527-5b7c-41ad-a624-ff186004e0cf)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>      Step     Time          Energy         fmax
BFGS:    0 11:58:27        0.004634        0.0000
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2023-06-02 11:58:27,492 INFO Finished job - EMT-Optimization (2f280527-5b7c-41ad-a624-ff186004e0cf)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2023-06-02 11:58:27,493 INFO Starting job - EMT-Optimization (19d52f40-4124-4b37-a77f-22d64a15720c)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>      Step     Time          Energy         fmax
BFGS:    0 11:58:27        0.000168        0.0000
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2023-06-02 11:58:27,525 INFO Finished job - EMT-Optimization (19d52f40-4124-4b37-a77f-22d64a15720c)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2023-06-02 11:58:27,525 INFO Starting job - EMT-Optimization (fbf64fd6-cc8c-4c01-bb69-23feff374360)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>      Step     Time          Energy         fmax
BFGS:    0 11:58:27       -0.000367        0.0000
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2023-06-02 11:58:27,563 INFO Finished job - EMT-Optimization (fbf64fd6-cc8c-4c01-bb69-23feff374360)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2023-06-02 11:58:27,565 INFO Starting job - EMT-Optimization (93d559a7-cfd6-41a2-a227-5f951ad30a2f)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>      Step     Time          Energy         fmax
BFGS:    0 11:58:27        0.000148        0.0000
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2023-06-02 11:58:27,595 INFO Finished job - EMT-Optimization (93d559a7-cfd6-41a2-a227-5f951ad30a2f)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2023-06-02 11:58:27,596 INFO Starting job - EMT-Optimization (a6d94697-e81f-4cf9-8ccd-afd14966bf2d)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>      Step     Time          Energy         fmax
BFGS:    0 11:58:27        0.004093        0.0000
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2023-06-02 11:58:27,630 INFO Finished job - EMT-Optimization (a6d94697-e81f-4cf9-8ccd-afd14966bf2d)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2023-06-02 11:58:27,631 INFO Starting job - EMT-Optimization (5dfef033-7668-4867-97c2-d4593a612e0a)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>      Step     Time          Energy         fmax
BFGS:    0 11:58:27        0.011572        0.0000
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2023-06-02 11:58:27,662 INFO Finished job - EMT-Optimization (5dfef033-7668-4867-97c2-d4593a612e0a)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2023-06-02 11:58:27,663 INFO Starting job - store_inputs (cc5a0c98-baff-4c82-850c-cb9c66888266, 2)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2023-06-02 11:58:27,667 INFO Finished job - store_inputs (cc5a0c98-baff-4c82-850c-cb9c66888266, 2)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2023-06-02 11:58:27,668 INFO Starting job - get_results_ev_curve (db195804-b7f1-4204-8e65-86208fca345f)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2023-06-02 11:58:28,120 INFO Finished job - get_results_ev_curve (db195804-b7f1-4204-8e65-86208fca345f)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2023-06-02 11:58:28,124 INFO Finished executing jobs locally
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;V0&#39;: 16.7748202620472, &#39;e0&#39;: -0.00036673834964062735, &#39;B&#39;: 0.6250761058809655}
</pre></div>
</div>
<img alt="_images/a405f44f3286e2389ed38d6c88e1f4e8d572d2cab160ea362ef1253a24b8a5cb.png" src="_images/a405f44f3286e2389ed38d6c88e1f4e8d572d2cab160ea362ef1253a24b8a5cb.png" />
</div>
</div>
<p>It works. We get the same results!</p>
<p>I will just show you now how to validate your data with a <a class="reference external" href="https://docs.pydantic.dev">pydantic</a> schema. This allows to describe your outputs and make sure that you also get all relevant data in the right format. Again, this is only one tiny example. In practice, you would add many more options! This is how such a schema can look in practice: <a class="github reference external" href="https://github.com/materialsproject/atomate2/blob/main/src/atomate2/lobster/schemas.py">materialsproject/atomate2</a></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pydantic</span> <span class="kn">import</span> <span class="n">BaseModel</span><span class="p">,</span> <span class="n">Field</span>


<span class="k">class</span> <span class="nc">EOS_Schema</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Schema to store outputs from EV curve.&quot;&quot;&quot;</span>

    <span class="n">V0</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="s2">&quot;Volume in Angstrom**3&quot;</span><span class="p">)</span>
    <span class="n">e0</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="s2">&quot;Energy in eV&quot;</span><span class="p">)</span>
    <span class="n">B</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="s2">&quot;Bulk modulus&quot;</span><span class="p">,</span>
    <span class="p">)</span>


<span class="nd">@job</span><span class="p">(</span><span class="n">output_schema</span><span class="o">=</span><span class="n">EOS_Schema</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">get_results_ev_curve</span><span class="p">(</span><span class="n">list_structures</span><span class="p">,</span> <span class="n">list_energies</span><span class="p">):</span>
    <span class="n">list_volumes</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">struct</span> <span class="ow">in</span> <span class="n">list_structures</span><span class="p">:</span>
        <span class="n">list_volumes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">struct</span><span class="o">.</span><span class="n">volume</span><span class="p">)</span>

    <span class="n">eos</span> <span class="o">=</span> <span class="n">EquationOfState</span><span class="p">(</span><span class="n">list_volumes</span><span class="p">,</span> <span class="n">list_energies</span><span class="p">)</span>
    <span class="n">v0</span><span class="p">,</span> <span class="n">e0</span><span class="p">,</span> <span class="n">B</span> <span class="o">=</span> <span class="n">eos</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
    <span class="n">eos</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="s1">&#39;eos.png&#39;</span><span class="p">)</span>

    <span class="n">results</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">results</span><span class="p">[</span><span class="s2">&quot;V0&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">v0</span>
    <span class="n">results</span><span class="p">[</span><span class="s2">&quot;e0&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">e0</span>
    <span class="n">results</span><span class="p">[</span><span class="s2">&quot;B&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">B</span>
    <span class="n">schema</span> <span class="o">=</span> <span class="n">EOS_Schema</span><span class="p">(</span><span class="o">**</span><span class="n">results</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="n">schema</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Let’s run the workflow again.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">atoms</span> <span class="o">=</span> <span class="n">bulk</span><span class="p">(</span><span class="s2">&quot;Ag&quot;</span><span class="p">,</span> <span class="s2">&quot;fcc&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<span class="n">structure</span> <span class="o">=</span> <span class="n">AseAtomsAdaptor</span><span class="p">()</span><span class="o">.</span><span class="n">get_structure</span><span class="p">(</span><span class="n">atoms</span><span class="p">)</span>
<span class="n">maker_fullopt</span> <span class="o">=</span> <span class="n">OptimizeJob</span><span class="p">()</span>
<span class="n">job1</span> <span class="o">=</span> <span class="n">maker_fullopt</span><span class="o">.</span><span class="n">make</span><span class="p">(</span><span class="n">structure</span><span class="o">=</span><span class="n">structure</span><span class="p">)</span>
<span class="n">job2</span> <span class="o">=</span> <span class="n">get_ev_curve</span><span class="p">(</span><span class="n">structure</span><span class="o">=</span><span class="n">job1</span><span class="o">.</span><span class="n">output</span><span class="p">[</span><span class="s2">&quot;optimized_structure&quot;</span><span class="p">])</span>
<span class="n">job3</span> <span class="o">=</span> <span class="n">get_results_ev_curve</span><span class="p">(</span><span class="n">list_structures</span><span class="o">=</span><span class="n">job2</span><span class="o">.</span><span class="n">output</span><span class="p">[</span><span class="s2">&quot;optimized_structures&quot;</span><span class="p">],</span> <span class="n">list_energies</span><span class="o">=</span><span class="n">job2</span><span class="o">.</span><span class="n">output</span><span class="p">[</span><span class="s2">&quot;energies&quot;</span><span class="p">])</span>
<span class="n">flow</span> <span class="o">=</span> <span class="n">Flow</span><span class="p">([</span><span class="n">job1</span><span class="p">,</span> <span class="n">job2</span><span class="p">,</span> <span class="n">job3</span><span class="p">],</span> <span class="n">output</span><span class="o">=</span><span class="n">job3</span><span class="o">.</span><span class="n">output</span><span class="p">)</span>

<span class="n">response</span> <span class="o">=</span> <span class="n">run_locally</span><span class="p">(</span><span class="n">flow</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">response</span><span class="p">[</span><span class="n">flow</span><span class="o">.</span><span class="n">jobs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">uuid</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">output</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2023-06-02 11:58:28,370 INFO Started executing jobs locally
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2023-06-02 11:58:28,373 INFO Starting job - EMT-Optimization (8eb69159-b84b-4493-b2df-dd0c1a0e21aa)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>      Step     Time          Energy         fmax
BFGS:    0 11:58:28        0.011870        0.5285
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>BFGS:    1 11:58:28        0.002888        0.2672
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>BFGS:    2 11:58:28       -0.000355        0.0156
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>BFGS:    3 11:58:28       -0.000367        0.0005
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>BFGS:    4 11:58:28       -0.000367        0.0000
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2023-06-02 11:58:28,493 INFO Finished job - EMT-Optimization (8eb69159-b84b-4493-b2df-dd0c1a0e21aa)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2023-06-02 11:58:28,494 INFO Starting job - get_ev_curve (b4bbe972-0853-4d08-8f9c-ae09ce359d12)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2023-06-02 11:58:28,513 INFO Finished job - get_ev_curve (b4bbe972-0853-4d08-8f9c-ae09ce359d12)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2023-06-02 11:58:28,519 INFO Starting job - EMT-Optimization (8812f7e4-0bf9-432a-a12e-35751f253b07)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>      Step     Time          Energy         fmax
BFGS:    0 11:58:28        0.014081        0.0000
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2023-06-02 11:58:28,551 INFO Finished job - EMT-Optimization (8812f7e4-0bf9-432a-a12e-35751f253b07)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2023-06-02 11:58:28,552 INFO Starting job - EMT-Optimization (2197f096-29d5-4cde-bd9e-b4a925c966fb)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>      Step     Time          Energy         fmax
BFGS:    0 11:58:28        0.004634        0.0000
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2023-06-02 11:58:28,581 INFO Finished job - EMT-Optimization (2197f096-29d5-4cde-bd9e-b4a925c966fb)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2023-06-02 11:58:28,581 INFO Starting job - EMT-Optimization (58e55238-6af3-492b-ab1a-b72fd028124d)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>      Step     Time          Energy         fmax
BFGS:    0 11:58:28        0.000168        0.0000
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2023-06-02 11:58:28,609 INFO Finished job - EMT-Optimization (58e55238-6af3-492b-ab1a-b72fd028124d)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2023-06-02 11:58:28,610 INFO Starting job - EMT-Optimization (7df40f29-b9a9-44e8-b8a7-3e3962fa8720)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>      Step     Time          Energy         fmax
BFGS:    0 11:58:28       -0.000367        0.0000
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2023-06-02 11:58:28,638 INFO Finished job - EMT-Optimization (7df40f29-b9a9-44e8-b8a7-3e3962fa8720)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2023-06-02 11:58:28,638 INFO Starting job - EMT-Optimization (d7d1351f-ba39-4938-aebe-21449372b13a)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>      Step     Time          Energy         fmax
BFGS:    0 11:58:28        0.000148        0.0000
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2023-06-02 11:58:28,666 INFO Finished job - EMT-Optimization (d7d1351f-ba39-4938-aebe-21449372b13a)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2023-06-02 11:58:28,667 INFO Starting job - EMT-Optimization (2ce92e61-3295-4b4a-8e8a-9804a775ba10)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>      Step     Time          Energy         fmax
BFGS:    0 11:58:28        0.004093        0.0000
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2023-06-02 11:58:28,693 INFO Finished job - EMT-Optimization (2ce92e61-3295-4b4a-8e8a-9804a775ba10)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2023-06-02 11:58:28,694 INFO Starting job - EMT-Optimization (44e96080-ce0a-4970-a8d4-22ec018d09aa)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>      Step     Time          Energy         fmax
BFGS:    0 11:58:28        0.011572        0.0000
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2023-06-02 11:58:28,726 INFO Finished job - EMT-Optimization (44e96080-ce0a-4970-a8d4-22ec018d09aa)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2023-06-02 11:58:28,727 INFO Starting job - store_inputs (b4bbe972-0853-4d08-8f9c-ae09ce359d12, 2)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2023-06-02 11:58:28,731 INFO Finished job - store_inputs (b4bbe972-0853-4d08-8f9c-ae09ce359d12, 2)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2023-06-02 11:58:28,732 INFO Starting job - get_results_ev_curve (d40abd3a-c727-4380-9284-5743212b7cee)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2023-06-02 11:58:28,933 INFO Finished job - get_results_ev_curve (d40abd3a-c727-4380-9284-5743212b7cee)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2023-06-02 11:58:28,934 INFO Finished executing jobs locally
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>V0=16.7748202620472 e0=-0.00036673834964062735 B=0.6250761058809655
</pre></div>
</div>
<img alt="_images/a405f44f3286e2389ed38d6c88e1f4e8d572d2cab160ea362ef1253a24b8a5cb.png" src="_images/a405f44f3286e2389ed38d6c88e1f4e8d572d2cab160ea362ef1253a24b8a5cb.png" />
</div>
</div>
<p>You have seen all basic functionalities to write workflows with jobflow. You can also transfer these workflows to <a class="reference external" href="https://materialsproject.github.io/atomate2/user/fireworks.html">Fireworks</a> to run the jobs in parallel and/or on a cluster.</p>
</section>
<section id="exercise">
<h3>Exercise<a class="headerlink" href="#exercise" title="Permalink to this heading">#</a></h3>
<p>Please build a large maker for the whole workflow! You can find an example here: <a class="github reference external" href="https://github.com/materialsproject/atomate2/blob/main/src/atomate2/vasp/flows/lobster.py">materialsproject/atomate2</a></p>
<p>Then, apply it to different structures and elements: e.g., Al or other elements that work with EMT.</p>
</section>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="phonon-workflow">
<h1>Phonon workflow<a class="headerlink" href="#phonon-workflow" title="Permalink to this heading">#</a></h1>
<p>We will now write a tiny workflow to compute phonons with Phonopy. We will only compute phonon densities of states and not band structures as finding relevant points in reciprocal space is possible but a lot of work to implement. If you would like to try this, you are invited to have fun with pymatgen. Again, we will use the EMT calculator to speed up calculations.</p>
<p>We will compute phonons with the finite differences approach. You can check out this reference in case you are interested: <a class="reference external" href="https://onlinelibrary.wiley.com/doi/10.1002/anie.200906780">https://onlinelibrary.wiley.com/doi/10.1002/anie.200906780</a>. We will optimize the crystal structure, then generate displaced structures. This will allow to compute force constants for the whole unit cell. Those force constants can then be fouriertransformed to a dynamical matrix that allows us to get frequencies and eigenvalues describing the vibrations in the crystal structure.</p>
<p><img alt="workflow for phonons" src="workflow2.png" /></p>
<p>For phonon runs, we need an additional static job that just returns forces based on the structure. We can reuse the optimization. But first, we will install phonopy. Phonopy will create all displacements that we need according to symmetry and can also do all the annoying computations that are just a pain to reimplement. There are also some modules in ase for phonons but they don’t handle symmetry that well so far!</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>%%capture
!pip install phonopy
</pre></div>
</div>
</div>
</div>
<p>Let’s build a static job first. This time, we also need the forces …</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">StaticJob</span><span class="p">(</span><span class="n">Maker</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Class to compute energy and forces for a structure</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    name</span>
<span class="sd">        Name of the job.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;EMT-StaticRun&quot;</span>

    <span class="nd">@job</span>
    <span class="k">def</span> <span class="nf">make</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">structure</span><span class="p">:</span> <span class="n">Structure</span><span class="p">):</span>
        <span class="n">adaptor</span> <span class="o">=</span> <span class="n">AseAtomsAdaptor</span><span class="p">()</span>
        <span class="n">atoms</span> <span class="o">=</span> <span class="n">adaptor</span><span class="o">.</span><span class="n">get_atoms</span><span class="p">(</span><span class="n">structure</span><span class="p">)</span>
        <span class="n">atoms</span><span class="o">.</span><span class="n">calc</span> <span class="o">=</span> <span class="n">EMT</span><span class="p">()</span>
        <span class="n">results</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">results</span><span class="p">[</span><span class="s2">&quot;input_structure&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">structure</span>
        <span class="n">results</span><span class="p">[</span><span class="s2">&quot;energy&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">atoms</span><span class="o">.</span><span class="n">get_potential_energy</span><span class="p">()</span>
        <span class="n">results</span><span class="p">[</span><span class="s2">&quot;force&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">atoms</span><span class="o">.</span><span class="n">get_forces</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">results</span>
</pre></div>
</div>
</div>
</div>
<p>Now, we need to build jobs that will create displacements for the finite displacement method based on an optimized <code class="docutils literal notranslate"><span class="pre">Structure</span></code>, run all static runs and then collect the results. It’s important to remember that you have to wait for a job to be executed before you can do something with the result in another job! You might be able to collect results from a job that will be run (e.g., put the result in a list but you are actually only collecting references) but you cannot perform any kind of numerical operation on it. You can only do this in the next job! The reference has to be resolved first!</p>
<p>Let’s start with the job creating displacements:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">phonopy</span> <span class="kn">import</span> <span class="n">Phonopy</span>
<span class="kn">from</span> <span class="nn">phonopy.units</span> <span class="kn">import</span> <span class="n">VaspToTHz</span>
<span class="kn">from</span> <span class="nn">pymatgen.io.phonopy</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">get_phonopy_structure</span><span class="p">,</span>
    <span class="n">get_pmg_structure</span><span class="p">,</span>
<span class="p">)</span>


<span class="nd">@job</span>
<span class="k">def</span> <span class="nf">create_displacements</span><span class="p">(</span><span class="n">structure</span><span class="p">:</span> <span class="n">Structure</span><span class="p">,</span> <span class="n">supercell_matrix</span><span class="p">):</span>
    <span class="n">factor</span> <span class="o">=</span> <span class="n">VaspToTHz</span>  <span class="c1"># we need this conversion factor. We will rely on eV</span>
    <span class="n">cell</span> <span class="o">=</span> <span class="n">get_phonopy_structure</span><span class="p">(</span><span class="n">structure</span><span class="p">)</span>  <span class="c1"># this transforms the structure into a format that phonopy can use</span>
    <span class="n">phonon</span> <span class="o">=</span> <span class="n">Phonopy</span><span class="p">(</span>
        <span class="n">cell</span><span class="p">,</span>
        <span class="n">supercell_matrix</span><span class="p">,</span>  <span class="c1"># we need to compute forces for displaced supercells of our inital structure</span>
        <span class="n">factor</span><span class="o">=</span><span class="n">factor</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">phonon</span><span class="o">.</span><span class="n">generate_displacements</span><span class="p">()</span>  <span class="c1"># phonopy will generate the displacements</span>

    <span class="n">supercells</span> <span class="o">=</span> <span class="n">phonon</span><span class="o">.</span><span class="n">supercells_with_displacements</span>  <span class="c1"># these are all displaced structures</span>

    <span class="n">displacements</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">icell</span> <span class="ow">in</span> <span class="n">supercells</span><span class="p">:</span>
        <span class="n">displacements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">get_pmg_structure</span><span class="p">(</span><span class="n">icell</span><span class="p">))</span>  <span class="c1"># we will collect all structures in a pymatgen structure format</span>

    <span class="k">return</span> <span class="n">displacements</span>
</pre></div>
</div>
</div>
</div>
<p>Now, we will generate static jobs for all of the generated structures</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nd">@job</span>
<span class="k">def</span> <span class="nf">run_displacements</span><span class="p">(</span><span class="n">displacements</span><span class="p">):</span>
    <span class="n">static_maker</span> <span class="o">=</span> <span class="n">StaticJob</span><span class="p">()</span>
    <span class="n">runs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">forces</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">displacement</span> <span class="ow">in</span> <span class="n">displacements</span><span class="p">:</span>
        <span class="n">displacement_run</span> <span class="o">=</span> <span class="n">static_maker</span><span class="o">.</span><span class="n">make</span><span class="p">(</span><span class="n">displacement</span><span class="p">)</span>
        <span class="n">forces</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">displacement_run</span><span class="o">.</span><span class="n">output</span><span class="p">[</span>
                          <span class="s2">&quot;force&quot;</span><span class="p">])</span>  <span class="c1"># this is possible but you cannot transform the array to a numpy array yet as the static_maker jobs haven&#39;t been run yet!</span>
        <span class="n">runs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">displacement_run</span><span class="p">)</span>

    <span class="n">output</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;forces&quot;</span><span class="p">:</span> <span class="n">forces</span><span class="p">}</span>  <span class="c1">#we will collect all forces from the runs.</span>

    <span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="n">replace</span><span class="o">=</span><span class="n">Flow</span><span class="p">(</span><span class="n">runs</span><span class="p">,</span> <span class="n">output</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p>Now, we will write a job that evaluates all results. We again need to recreate the correct phonopy settings.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pymatgen.phonon.plotter</span> <span class="kn">import</span> <span class="n">PhononDosPlotter</span>
<span class="kn">from</span> <span class="nn">pymatgen.io.phonopy</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">get_ph_dos</span>
<span class="p">)</span>


<span class="nd">@job</span>
<span class="k">def</span> <span class="nf">summarize_phonopy_results</span><span class="p">(</span><span class="n">structure</span><span class="p">:</span> <span class="n">Structure</span><span class="p">,</span> <span class="n">forces</span><span class="p">,</span> <span class="n">supercell_matrix</span><span class="p">,</span> <span class="n">kpoints</span><span class="o">=</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">]):</span>
    <span class="n">forces_set</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">force</span> <span class="ow">in</span> <span class="n">forces</span><span class="p">:</span>
        <span class="n">forces_set</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">force</span><span class="p">))</span>

    <span class="n">factor</span> <span class="o">=</span> <span class="n">VaspToTHz</span>
    <span class="n">cell</span> <span class="o">=</span> <span class="n">get_phonopy_structure</span><span class="p">(</span><span class="n">structure</span><span class="p">)</span>
    <span class="n">phonon</span> <span class="o">=</span> <span class="n">Phonopy</span><span class="p">(</span>
        <span class="n">cell</span><span class="p">,</span>
        <span class="n">supercell_matrix</span><span class="p">,</span>
        <span class="n">factor</span><span class="o">=</span><span class="n">factor</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">phonon</span><span class="o">.</span><span class="n">generate_displacements</span><span class="p">()</span>
    <span class="n">phonon</span><span class="o">.</span><span class="n">produce_force_constants</span><span class="p">(</span><span class="n">forces</span><span class="o">=</span><span class="n">forces_set</span><span class="p">)</span>
    <span class="n">phonon</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s2">&quot;phonopy.yaml&quot;</span><span class="p">)</span>
    <span class="n">phonon</span><span class="o">.</span><span class="n">run_mesh</span><span class="p">(</span><span class="n">kpoints</span><span class="p">)</span>
    <span class="n">phonon</span><span class="o">.</span><span class="n">run_total_dos</span><span class="p">()</span>
    <span class="n">phonon</span><span class="o">.</span><span class="n">write_total_dos</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="s2">&quot;phonon_dos.yaml&quot;</span><span class="p">)</span>
    <span class="n">dos</span> <span class="o">=</span> <span class="n">get_ph_dos</span><span class="p">(</span><span class="s2">&quot;phonon_dos.yaml&quot;</span><span class="p">)</span>
    <span class="n">new_plotter_dos</span> <span class="o">=</span> <span class="n">PhononDosPlotter</span><span class="p">()</span>
    <span class="n">new_plotter_dos</span><span class="o">.</span><span class="n">add_dos</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;total&quot;</span><span class="p">,</span> <span class="n">dos</span><span class="o">=</span><span class="n">dos</span><span class="p">)</span>
    <span class="n">new_plotter_dos</span><span class="o">.</span><span class="n">save_plot</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="s2">&quot;phonon_dos.eps&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;PhononDOS&quot;</span><span class="p">:</span> <span class="n">dos</span><span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<p>Now we connect the jobs with an optimzation.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">jobflow.managers.local</span> <span class="kn">import</span> <span class="n">run_locally</span>
<span class="kn">from</span> <span class="nn">jobflow</span> <span class="kn">import</span> <span class="n">Flow</span>
<span class="kn">from</span> <span class="nn">ase.build</span> <span class="kn">import</span> <span class="n">bulk</span>

<span class="kn">from</span> <span class="nn">pymatgen.io.ase</span> <span class="kn">import</span> <span class="n">AseAtomsAdaptor</span>
<span class="kn">from</span> <span class="nn">pymatgen.core.structure</span> <span class="kn">import</span> <span class="n">Structure</span>

<span class="n">atoms</span> <span class="o">=</span> <span class="n">bulk</span><span class="p">(</span><span class="s2">&quot;Ag&quot;</span><span class="p">,</span> <span class="s2">&quot;fcc&quot;</span><span class="p">,</span> <span class="mf">3.9</span><span class="p">)</span>
<span class="n">supercell_matrix</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]]</span>
<span class="n">structure</span> <span class="o">=</span> <span class="n">AseAtomsAdaptor</span><span class="p">()</span><span class="o">.</span><span class="n">get_structure</span><span class="p">(</span><span class="n">atoms</span><span class="p">)</span>
<span class="n">maker_fullopt</span> <span class="o">=</span> <span class="n">OptimizeJob</span><span class="p">()</span>
<span class="n">job1</span> <span class="o">=</span> <span class="n">maker_fullopt</span><span class="o">.</span><span class="n">make</span><span class="p">(</span><span class="n">structure</span><span class="o">=</span><span class="n">structure</span><span class="p">)</span>
<span class="n">job2</span> <span class="o">=</span> <span class="n">create_displacements</span><span class="p">(</span><span class="n">structure</span><span class="o">=</span><span class="n">job1</span><span class="o">.</span><span class="n">output</span><span class="p">[</span><span class="s2">&quot;optimized_structure&quot;</span><span class="p">],</span> <span class="n">supercell_matrix</span><span class="o">=</span><span class="n">supercell_matrix</span><span class="p">)</span>
<span class="n">job3</span> <span class="o">=</span> <span class="n">run_displacements</span><span class="p">(</span><span class="n">displacements</span><span class="o">=</span><span class="n">job2</span><span class="o">.</span><span class="n">output</span><span class="p">)</span>
<span class="n">job4</span> <span class="o">=</span> <span class="n">summarize_phonopy_results</span><span class="p">(</span><span class="n">structure</span><span class="o">=</span><span class="n">job1</span><span class="o">.</span><span class="n">output</span><span class="p">[</span><span class="s2">&quot;optimized_structure&quot;</span><span class="p">],</span> <span class="n">forces</span><span class="o">=</span><span class="n">job3</span><span class="o">.</span><span class="n">output</span><span class="p">[</span><span class="s2">&quot;forces&quot;</span><span class="p">],</span>
                                 <span class="n">supercell_matrix</span><span class="o">=</span><span class="n">supercell_matrix</span><span class="p">)</span>
<span class="n">flow</span> <span class="o">=</span> <span class="n">Flow</span><span class="p">([</span><span class="n">job1</span><span class="p">,</span> <span class="n">job2</span><span class="p">,</span> <span class="n">job3</span><span class="p">,</span> <span class="n">job4</span><span class="p">],</span> <span class="n">output</span><span class="o">=</span><span class="n">job4</span><span class="o">.</span><span class="n">output</span><span class="p">)</span>

<span class="n">response</span> <span class="o">=</span> <span class="n">run_locally</span><span class="p">(</span><span class="n">flow</span><span class="p">)</span>

<span class="n">new_plotter_dos</span> <span class="o">=</span> <span class="n">PhononDosPlotter</span><span class="p">()</span>
<span class="n">new_plotter_dos</span><span class="o">.</span><span class="n">add_dos</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;total&quot;</span><span class="p">,</span> <span class="n">dos</span><span class="o">=</span><span class="n">response</span><span class="p">[</span><span class="n">flow</span><span class="o">.</span><span class="n">jobs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">uuid</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">output</span><span class="p">[</span><span class="s2">&quot;PhononDOS&quot;</span><span class="p">])</span>
<span class="n">new_plotter_dos</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2023-06-02 11:58:32,066 INFO Started executing jobs locally
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2023-06-02 11:58:32,073 INFO Starting job - EMT-Optimization (9c037fdd-0274-4eaf-846d-0326fd81927c)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>      Step     Time          Energy         fmax
BFGS:    0 11:58:32        0.088477        1.5173
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>BFGS:    1 11:58:32        0.018361        0.6601
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>BFGS:    2 11:58:32       -0.000016        0.0864
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>BFGS:    3 11:58:32       -0.000365        0.0064
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>BFGS:    4 11:58:32       -0.000367        0.0001
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>BFGS:    5 11:58:32       -0.000367        0.0000
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2023-06-02 11:58:32,304 INFO Finished job - EMT-Optimization (9c037fdd-0274-4eaf-846d-0326fd81927c)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2023-06-02 11:58:32,305 INFO Starting job - create_displacements (80b343e5-dd10-4381-be94-2b30d96d0978)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2023-06-02 11:58:32,498 INFO Finished job - create_displacements (80b343e5-dd10-4381-be94-2b30d96d0978)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2023-06-02 11:58:32,501 INFO Starting job - run_displacements (1cbc3173-4769-48dd-923a-2d02f4d929a8)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2023-06-02 11:58:32,574 INFO Finished job - run_displacements (1cbc3173-4769-48dd-923a-2d02f4d929a8)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2023-06-02 11:58:32,578 INFO Starting job - EMT-StaticRun (6d40159b-2d12-455b-8f67-e3ac68f86cde)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2023-06-02 11:58:32,648 INFO Finished job - EMT-StaticRun (6d40159b-2d12-455b-8f67-e3ac68f86cde)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2023-06-02 11:58:32,650 INFO Starting job - store_inputs (1cbc3173-4769-48dd-923a-2d02f4d929a8, 2)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2023-06-02 11:58:32,697 INFO Finished job - store_inputs (1cbc3173-4769-48dd-923a-2d02f4d929a8, 2)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2023-06-02 11:58:32,699 INFO Starting job - summarize_phonopy_results (c7f05a62-9b8f-4e05-8163-568ca80471c7)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The PostScript backend does not support transparency; partially transparent artists will be rendered opaque.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2023-06-02 11:58:33,641 INFO Finished job - summarize_phonopy_results (c7f05a62-9b8f-4e05-8163-568ca80471c7)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2023-06-02 11:58:33,643 INFO Finished executing jobs locally
</pre></div>
</div>
<img alt="_images/920b659ab65c6cf08195bf4d82907a4e5c6cc0bd41ac2b9c73e613f3608b10af.png" src="_images/920b659ab65c6cf08195bf4d82907a4e5c6cc0bd41ac2b9c73e613f3608b10af.png" />
</div>
</div>
<section id="id1">
<h2>Exercise<a class="headerlink" href="#id1" title="Permalink to this heading">#</a></h2>
<p>Again, plug the flow into a maker. Then, build an even larger maker including 3 phonon runs at the optimized volume, one with a volume that is 1% smaller and one with a volume that is 1% larger. This is a typical setting to compute Grüneisen parameters.</p>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="intro.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Introduction</p>
      </div>
    </a>
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">The Tutorial</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#jobflow">Jobflow</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#install-software">Install Software</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#workflow-to-compute-the-equation-of-state-e-g-to-compute-a-bulk-modulus">Workflow to compute the equation of state (e.g., to compute a bulk modulus)</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#effective-medium-theory">Effective Medium Theory</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#structure-optimization">Structure optimization</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise">Exercise</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#phonon-workflow">Phonon workflow</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Exercise</a></li>
</ul>
</li>
</ul>

  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By J. George
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      © Copyright 2022.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>